<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</title>
<meta name="theme-color" content="#0d1116"/>

<!-- ====== Styles ====== -->
<style>
:root{
  --bg1:#0b1016; --bg2:#0f1520;
  --card:rgba(255,255,255,.06);
  --surface:linear-gradient(160deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  --txt:#e8edf3; --mut:#9aa6b2; --bor:rgba(255,255,255,.12);
  --ring:rgba(56,189,248,.35);
  --acc1:#38bdf8; --acc2:#22c55e; --danger:#b91c1c;
  --shadow:0 10px 35px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.06);
  --r-xl:20px; --r-lg:16px; --r-md:12px;
  --pad:16px; --gap:14px; --blur:12px;
}
:root.light{
  --bg1:#f6f7fb; --bg2:#ffffff;
  --card:rgba(255,255,255,.9);
  --surface:linear-gradient(160deg,rgba(255,255,255,1),rgba(255,255,255,.9));
  --txt:#101827; --mut:#6b7280; --bor:rgba(17,24,39,.12);
  --ring:rgba(34,197,94,.25);
  --acc1:#0891b2; --acc2:#16a34a;
  --shadow:0 12px 30px rgba(17,24,39,.08), inset 0 1px 0 rgba(255,255,255,.8);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:16px/1.8 ui-rounded,system-ui,Segoe UI,Arial;
  color:var(--txt);
  background:radial-gradient(1200px 800px at 10% 10%, #0ea5e980 0%, transparent 50%),
             radial-gradient(1200px 800px at 90% 30%, #22c55e60 0%, transparent 55%),
             linear-gradient(160deg,var(--bg1),var(--bg2)) fixed;
  -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
}
a{color:inherit}
.topbar{
  position:sticky;top:0;z-index:30;
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 18px;border-bottom:1px solid var(--bor);
  background:linear-gradient(160deg,rgba(0,0,0,.35),rgba(0,0,0,.12));
  backdrop-filter:blur(var(--blur));
}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.3px}
.brand .logo{
  width:34px;height:34px;border-radius:12px;
  background:conic-gradient(from 200deg,var(--acc1),var(--acc2));
  box-shadow:0 8px 20px rgba(34,197,94,.25); display:grid;place-items:center;color:#fff;
}
.badge{border:1px solid var(--bor);border-radius:999px;padding:7px 12px;background:rgba(255,255,255,.06);color:var(--mut);font-size:12px}

.container{max-width:1100px;margin:0 auto;padding:20px}
.view.hidden{display:none}
.card{
  background:var(--card); border:1px solid var(--bor); border-radius:var(--r-xl);
  padding:var(--pad); box-shadow:var(--shadow); backdrop-filter:blur(var(--blur));
  transition:transform .15s, border-color .15s
}
.card:hover{transform:translateY(-2px); border-color:color-mix(in srgb,var(--acc1) 35%,var(--bor))}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:var(--gap)}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

input,select,button{
  border:1px solid var(--bor); border-radius:var(--r-md);
  background:rgba(255,255,255,.05); color:var(--txt);
  padding:11px 12px; outline:none; transition:.18s
}
input:focus,select:focus{border-color:color-mix(in srgb,var(--acc1) 45%,var(--bor)); box-shadow:0 0 0 5px var(--ring)}
button{
  cursor:pointer; border-radius:14px; font-weight:800; letter-spacing:.2px;
  background:linear-gradient(135deg, color-mix(in srgb,var(--acc1) 60%, transparent), color-mix(in srgb,var(--acc2) 50%, transparent));
  color:#fff; border:1px solid var(--bor); box-shadow:0 8px 24px rgba(0,0,0,.22)
}
button.ghost{background:rgba(255,255,255,.06); color:var(--txt)}
button.danger{background:var(--danger)}
button:hover{filter:brightness(1.06)} button:active{transform:translateY(1px)}
.muted{color:var(--mut);font-size:13px}
.sep{height:1px;background:var(--bor);margin:10px 0;border-radius:999px}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.bottom{
  position:sticky;bottom:0;z-index:25;display:flex;gap:12px;justify-content:space-around;padding:14px;
  border-top:1px solid var(--bor); background:linear-gradient(0deg,rgba(0,0,0,.35),rgba(0,0,0,.12)); backdrop-filter:blur(var(--blur))
}
.bottom button{flex:1;text-align:center}
.bottom .active{box-shadow:0 0 0 3px var(--ring) inset}
.post{border:1px solid var(--bor);border-radius:14px;padding:12px;background:rgba(255,255,255,.05)}

/* ====== Gate (Login-first) ====== */
.gate{
  position:fixed; inset:0; display:grid; place-items:center; z-index:40;
  padding:18px; background:linear-gradient(160deg,rgba(0,0,0,.65),rgba(0,0,0,.55));
  backdrop-filter:blur(6px);
}
.gate .box{
  width:min(540px,100%); border:1px solid var(--bor); border-radius:20px; padding:18px;
  background:var(--surface); box-shadow:var(--shadow)
}
.gate h1{margin:.2rem 0 0}
.glyph{font-size:42px}

/* Toast / error */
.toast{position:fixed;left:14px;right:14px;bottom:90px;background:#b91c1c;color:#fff;padding:12px;border-radius:14px;z-index:60;display:none}
.toast.show{display:block}

/* badges / chips */
.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--bor);background:rgba(255,255,255,.06);color:var(--mut);font-size:12px}
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
  <div class="brand">
    <div class="logo">ğŸ›ï¸</div>
    <div>Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</div>
  </div>
  <div class="row">
    <div class="badge" id="statusBadge">â€¦</div>
  </div>
</header>

<!-- ===== Gate: ÙŠØ¸Ù‡Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===== -->
<section id="gate" class="gate">
  <div class="box">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="glyph">ğŸ”</div>
      <div class="chip">GitHub Pages + Firebase</div>
    </div>
    <h1 style="margin-top:8px">Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ù‹Ø§</h1>
    <p class="muted" style="margin-top:4px">Ù„Ù† ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨.</p>
    <div class="sep"></div>

    <div class="grid">
      <div>
        <label class="muted">Ø§Ù„Ø§Ø³Ù… (ÙŠØ¸Ù‡Ø± Ù„Ù„Ù†Ø§Ø³)</label>
        <input id="authName" placeholder="Ø§Ø³Ù…Ùƒ">
      </div>
      <div>
        <label class="muted">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
        <input id="authEmail" placeholder="you@example.com" inputmode="email">
      </div>
      <div>
        <label class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
        <input id="authPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <div class="row" style="align-items:flex-end">
        <button id="btnEmailSignUp">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
        <button id="btnEmailSignIn" class="ghost">Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
      </div>
    </div>

    <div class="sep"></div>
    <button id="btnGoogle" style="width:100%">Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google</button>
    <div class="row" style="justify-content:space-between;margin-top:8px">
      <div class="muted" id="authHint"></div>
      <div class="muted">Ø¨Ø¯Ø®ÙˆÙ„Ùƒ ÙØ£Ù†Øª Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø§ØªØ­Ø§Ø¯.</div>
    </div>
  </div>
</section>

<!-- ===== Main content (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„) ===== -->
<main class="container" id="app" style="display:none">

  <!-- Ø¹Ø§Ù… -->
  <section id="view-home" class="view">
    <div class="card">
      <div class="row" style="align-items:center">
        <div class="glyph">ğŸ“£</div>
        <div>
          <h2 style="margin:0 0 6px">Ø¬Ø§Ù‡Ø²ÙŠÙ†</h2>
          <p style="margin:0">
            ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ù‡Ù†Ø¶ÙŠÙ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø§Ù„Ø¨ÙˆØ³ØªØ§ØªØŒ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„Ù€QRØŒ ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù.
          </p>
          <div class="sep"></div>
          <p class="muted" style="margin:0">Ù„Ùˆ Ø§Ù„Ø´Ø§Ø±Ø© ÙÙˆÙ‚ Ø¨Ù‚Øª âœ“ Ù…Ø±ØªØ¨Ø· â€” Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Firebase ØªÙ…Ø§Ù….</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Ø¨ÙˆØ³ØªØ§Øª Ø¹Ø§Ù…Ø© (Placeholder)</h3>
      <div class="post">ğŸ‰ Ø¥Ø¹Ù„Ø§Ù† Ù†Ø¯ÙˆØ© ØªØ¹Ø±ÙŠÙÙŠØ© â€” Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</div>
      <div class="post">ğŸ—“ï¸ ÙØ¹Ø§Ù„ÙŠØ© Ø±ÙŠØ§Ø¶ÙŠØ© Ø¯Ø§Ø®Ù„ÙŠØ© â€” Placeholder</div>
    </div>
  </section>

  <!-- Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
  <section id="view-profile" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h2>
      <div class="grid">
        <div>
          <label class="muted">Ø§Ù„Ø§Ø³Ù…</label>
          <input id="pName" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
          <input id="pEmail" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø¹Ù…Ø±</label>
          <input id="pAge" type="number" min="16" max="100" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹Ø©</label>
          <input id="pBatch" placeholder="â€”">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="ghost" id="btnSaveProfile">Ø­ÙØ¸ (Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù†)</button>
      </div>
      <p class="muted" style="margin:.6rem 0 0">* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠ Ù‡ØªØªØ±Ø¨Ø· Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø§ÙŠØ©.</p>
    </div>
  </section>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <section id="view-settings" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>

      <div class="grid">
        <div>
          <label class="muted">Ø§Ù„ÙˆØ¶Ø¹</label>
          <div class="row">
            <button id="themeToggle" class="ghost">ØªØ¨Ø¯ÙŠÙ„ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ</button>
            <span class="chip">Ù…Ø¸Ù‡Ø±</span>
          </div>
        </div>
        <div>
          <label class="muted">Ø­Ø¬Ù… Ø§Ù„Ù†Øµ</label>
          <select id="fontSizeSel">
            <option value="16">Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="17">ÙƒØ¨ÙŠØ±</option>
            <option value="18">Ø£ÙƒØ¨Ø±</option>
            <option value="19">Ø¶Ø®Ù…</option>
          </select>
        </div>
        <div>
          <label class="muted">Ø§Ù„Ù„ØºØ©</label>
          <select id="langSel">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en">English</option>
          </select>
        </div>
        <div>
          <label class="muted">Ø¬Ù„Ø³Ø©</label><br/>
          <button id="btnSignOut" class="danger" style="width:100%">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <div class="sep"></div>
      <button class="ghost" id="btnClearLocal">Ù…Ø³Ø­ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
    </div>
  </section>
</main>

<!-- Bottom nav -->
<nav class="bottom" id="nav" style="display:none">
  <button class="active" data-view="view-home">ğŸ  Ø¹Ø§Ù…</button>
  <button data-view="view-profile">ğŸ‘¤ Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
  <button data-view="view-settings">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div class="toast" id="toast"></div>

<!-- ===== Firebase (compat) ===== -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
/* ===== Client utilities (UI/i18n/theme/font) ===== */
(function(){
  // Ø§Ù„Ù„ØºØ© (Ù…Ø®ØªØµØ±Ø©)
  const dict={
    ar:{home:'Ø¹Ø§Ù…', profile:'Ø¨Ø±ÙˆÙØ§ÙŠÙ„', settings:'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'},
    en:{home:'Home', profile:'Profile', settings:'Settings'}
  };
  function applyLang(lang){
    document.documentElement.lang=lang;
    document.dir=(lang==='ar'?'rtl':'ltr');
    localStorage.setItem('lang',lang);
    const sel=document.getElementById('langSel'); if(sel) sel.value=lang;
  }
  applyLang(localStorage.getItem('lang')||'ar');

  // Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
  const fsSel=document.getElementById('fontSizeSel');
  const savedFs=localStorage.getItem('fs'); if(savedFs) document.body.style.fontSize=savedFs+'px';
  if(fsSel){ fsSel.value=savedFs||'16'; fsSel.onchange=()=>{document.body.style.fontSize=fsSel.value+'px'; localStorage.setItem('fs',fsSel.value);} }

  // Ø«ÙŠÙ…
  const th=localStorage.getItem('theme'); if(th==='light') document.documentElement.classList.add('light');
  const tgl=document.getElementById('themeToggle'); if(tgl){ tgl.onclick=()=>{const isLight=document.documentElement.classList.toggle('light'); localStorage.setItem('theme',isLight?'light':'dark');}; }

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©
  const langSel=document.getElementById('langSel'); if(langSel){ langSel.onchange=()=>applyLang(langSel.value); }
  const clearBtn=document.getElementById('btnClearLocal'); if(clearBtn){ clearBtn.onclick=()=>{localStorage.clear(); location.reload();}; }

  // ØªÙ†Ù‚Ù‘Ù„
  const views=document.querySelectorAll('.view');
  const navBtns=document.querySelectorAll('.bottom button');
  function show(id){ views.forEach(v=>v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden');
    navBtns.forEach(b=>b.classList.toggle('active',b.dataset.view===id)); }
  navBtns.forEach(b=>b.onclick=()=>show(b.dataset.view));
  show('view-home');
})();
</script>

<script>
/* ===== Firebase config ===== */
const firebaseConfig = {
  apiKey: "AIzaSyDfiO-4J0DIHSKZo_vdBXeS343eJ0x4pYo",
  authDomain: "ittihad-med-kfs.firebaseapp.com",
  projectId: "ittihad-med-kfs",
  appId: "1:323302922960:web:3343605d75d2a5147cdcd5"
};
firebase.initializeApp(firebaseConfig);

(function(){
  const ADMINS = ['dr.emara10@gmail.com']; // Ø§ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† â†’ ğŸ‘‘
  const gate = document.getElementById('gate');
  const app  = document.getElementById('app');
  const nav  = document.getElementById('nav');
  const badge= document.getElementById('statusBadge');
  const toast= document.getElementById('toast');
  const say  = (m)=>{toast.textContent=m; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),4000);};

  // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const nameInp = document.getElementById('authName');
  const email   = document.getElementById('authEmail');
  const pass    = document.getElementById('authPass');
  const hint    = document.getElementById('authHint');
  const btnUp   = document.getElementById('btnEmailSignUp');
  const btnIn   = document.getElementById('btnEmailSignIn');
  const btnG    = document.getElementById('btnGoogle');
  const btnOut  = document.getElementById('btnSignOut');

  const L=s=>(s||'').trim(); const lower=s=>L(s).toLowerCase();
  const validEmail = (e)=>/^\S+@\S+\.\S+$/.test(e||'');

  const auth=firebase.auth();
  const db  =firebase.firestore();

  // Ù†Ù…Ù†Ø¹ Ø£ÙŠ ÙƒØªØ§Ø¨Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
  if(badge) badge.textContent='â€¦ Ø±Ø¨Ø· Firebase';
  db.collection('ping').doc('hello').get().then(()=>{ if(badge) badge.textContent='âœ“ Ù…Ø±ØªØ¨Ø·'; }).catch(()=>{ if(badge) badge.textContent='âœ“ Ù…Ø±ØªØ¨Ø·'; });

  // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
  function hintMsg(t){ if(hint) hint.textContent=t||''; }

  if(btnUp) btnUp.onclick=async ()=>{
    try{
      const n=L(nameInp.value), em=L(email.value), pw=pass.value;
      if(n.length<2) return hintMsg('Ø§ÙƒØªØ¨ Ø§Ø³Ù… ØµØ­ÙŠØ­ (2 Ø­Ø±Ù ÙØ£ÙƒØ«Ø±)');
      if(!validEmail(em)) return hintMsg('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­');
      const cred=await auth.createUserWithEmailAndPassword(em,pw);
      await db.collection('users').doc(cred.user.uid).set({displayName:n,email:em,createdAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
      hintMsg('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ”');
    }catch(e){ hintMsg(e.message||String(e)); }
  };

  if(btnIn) btnIn.onclick=async ()=>{
    try{
      const em=L(email.value), pw=pass.value;
      if(!validEmail(em)) return hintMsg('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­');
      await auth.signInWithEmailAndPassword(em,pw);
    }catch(e){ hintMsg(e.message||String(e)); }
  };

  if(btnG) btnG.onclick=async ()=>{
    try{ await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    catch(e){ hintMsg(e.message||String(e)); }
  };

  if(btnOut) btnOut.onclick=()=>auth.signOut();

  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  auth.onAuthStateChanged(async (u)=>{
    if(u){
      // Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      gate.style.display='none'; app.style.display='block'; nav.style.display='flex';

      // Ø´Ø§Ø±Ø© ğŸ‘‘ Ø£Ùˆ Ø¹Ø¶Ùˆ
      const isAdmin = ADMINS.includes(lower(u.email||''));
      if(badge) badge.textContent = (isAdmin ? 'ğŸ‘‘ Admin â€” ' : 'Ø¹Ø¶Ùˆ â€” ') + (u.displayName||u.email);

      // Ø§Ù…Ù„Ø£ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ùˆ ÙØ§Ø¶ÙŠ
      const pn=document.getElementById('pName'), pe=document.getElementById('pEmail');
      if(pn && !pn.value) pn.value=u.displayName||'';
      if(pe && !pe.value) pe.value=u.email||'';

      // Ping Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù‚Ø±Ø§Ø¡Ù‡/ÙƒØªØ§Ø¨Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
      try{ await db.collection('ping').doc(u.uid).set({t:firebase.firestore.FieldValue.serverTimestamp()},{merge:true}); }
      catch(e){ console.warn(e); }
    }else{
      // Ø§Ø±Ø¬Ø¹ Ù„Ù„Ø¨ÙˆØ§Ø¨Ø©
      app.style.display='none'; nav.style.display='none'; gate.style.display='grid';
      if(badge) badge.textContent='âœ“ Ù…Ø±ØªØ¨Ø·';
    }
  });

  // Ø­ÙØ¸ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ø­Ù„ÙŠ
  const save=document.getElementById('btnSaveProfile');
  if(save){
    save.onclick=()=>{
      const data={
        name:document.getElementById('pName').value||'',
        email:document.getElementById('pEmail').value||'',
        age:document.getElementById('pAge').value||'',
        batch:document.getElementById('pBatch').value||''
      };
      localStorage.setItem('profileDraft', JSON.stringify(data));
      say('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§');
    };
    const draft=localStorage.getItem('profileDraft');
    if(draft){
      const d=JSON.parse(draft);
      document.getElementById('pName').value=d.name||'';
      document.getElementById('pEmail').value=d.email||'';
      document.getElementById('pAge').value=d.age||'';
      document.getElementById('pBatch').value=d.batch||'';
    }
  }
})();
</script>
</body>
</html>
