<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</title>
<meta name="theme-color" content="#0e1116"/>

<style>
:root{
  --bg1:#0b1016;--bg2:#0f1520;--txt:#e8edf3;--mut:#9aa6b2;
  --bor:rgba(255,255,255,.12);--card:rgba(255,255,255,.06);
  --acc:#38bdf8;--ok:#22c55e;--err:#ef4444;--ring:rgba(56,189,248,.35)
}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;font:16px/1.8 ui-rounded,system-ui,Segoe UI,Arial;color:var(--txt);
background:radial-gradient(1100px 700px at 10% 0%,#0ea5e960 0%,transparent 50%),
radial-gradient(1100px 700px at 100% 20%,#22c55e40 0%,transparent 55%),
linear-gradient(160deg,var(--bg1),var(--bg2)) fixed}
.topbar{position:sticky;top:0;z-index:20;display:flex;justify-content:space-between;align-items:center;
padding:14px 16px;border-bottom:1px solid var(--bor);background:rgba(0,0,0,.35);backdrop-filter:blur(8px)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900}
.badge{border:1px solid var(--bor);border-radius:999px;padding:6px 10px;color:var(--mut);background:rgba(255,255,255,.06);font-size:12px}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:var(--card);border:1px solid var(--bor);border-radius:16px;padding:16px}
.sep{height:1px;background:var(--bor);margin:10px 0;border-radius:999px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media(max-width:720px){.grid2{grid-template-columns:1fr}}

input,select,button{border:1px solid var(--bor);border-radius:12px;background:rgba(255,255,255,.06);color:var(--txt);padding:11px 12px;outline:none;transition:.15s}
input:focus,select:focus{border-color:var(--acc);box-shadow:0 0 0 4px var(--ring)}
button{cursor:pointer;font-weight:800;background:linear-gradient(135deg,#38bdf8,#22c55e);color:#fff}
button.ghost{background:rgba(255,255,255,.06);color:var(--txt)}
button.danger{background:#b91c1c}
.msg{font-size:12px;color:var(--mut);margin-top:6px}
.invalid{border-color:var(--err)!important}
.valid{border-color:var(--ok)!important}
.eye{position:absolute;inset-inline-end:10px;top:50%;transform:translateY(-50%);user-select:none;cursor:pointer;opacity:.85}
.field{position:relative}

.bottom{position:sticky;bottom:0;z-index:15;display:flex;gap:12px;justify-content:space-around;padding:14px;border-top:1px solid var(--bor);background:rgba(0,0,0,.35);backdrop-filter:blur(8px)}
.bottom button{flex:1} .bottom .active{box-shadow:0 0 0 3px var(--ring) inset}
.view.hidden{display:none}

/* Gate (Auth) */
.gate{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);z-index:40}
.box{width:min(640px,100%);background:rgba(255,255,255,.06);border:1px solid var(--bor);border-radius:18px;padding:16px}
.tabs{display:flex;gap:8px;border-bottom:1px solid var(--bor);margin-bottom:10px}
.tab{border:1px solid var(--bor);border-bottom:none;border-radius:12px 12px 0 0;background:rgba(255,255,255,.06);padding:10px 12px;color:var(--mut);cursor:pointer}
.tab.active{background:rgba(0,0,0,.12);color:var(--txt)}
.panel{display:none}.panel.show{display:block}

/* toast */
.toast{position:fixed;left:12px;right:12px;bottom:86px;background:#b91c1c;color:#fff;padding:12px;border-radius:14px;z-index:60;display:none}
.toast.show{display:block}
</style>
</head>
<body>

<header class="topbar">
  <div class="brand">ğŸ›ï¸ Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</div>
  <div id="status" class="badge">â€¦</div>
</header>

<!-- ===== Gate (Sign Up / Sign In) ===== -->
<section id="gate" class="gate">
  <div class="box">
    <div class="tabs">
      <button class="tab active" data-tab="up" type="button">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      <button class="tab" data-tab="in" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- Sign Up -->
    <div id="p-up" class="panel show">
      <div class="grid2">
        <div class="field">
          <label class="msg">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="suEmail" inputmode="email" placeholder="you@example.com">
          <div class="msg" id="mSuEmail"></div>
        </div>
        <div>
          <label class="msg">Ø§Ù„Ù„ØºØ©</label>
          <select id="suLang"><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option><option value="en">English</option></select>
        </div>

        <div class="field">
          <label class="msg">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="suPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          <span class="eye" data-eye="suPass">ğŸ‘ï¸</span>
          <div class="msg" id="mSuPass"></div>
        </div>
        <div class="field">
          <label class="msg">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="suPass2" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          <span class="eye" data-eye="suPass2">ğŸ‘ï¸</span>
          <div class="msg" id="mSuPass2"></div>
        </div>

        <div class="field">
          <label class="msg">Ø§Ù„Ø§Ø³Ù… (Ø§Ø³Ù… + Ø¹Ø§Ø¦Ù„Ø©)</label>
          <input id="suName" placeholder="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯">
          <div class="msg" id="mSuName"></div>
        </div>
        <div class="field">
          <label class="msg">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
          <input id="suPhone" inputmode="tel" placeholder="01xxxxxxxxx">
          <div class="msg" id="mSuPhone"></div>
        </div>

        <div class="field">
          <label class="msg">Ø§Ù„Ø¯ÙØ¹Ø©</label>
          <input id="suBatch" placeholder="Ù…Ø«Ø§Ù„: 12">
          <div class="msg" id="mSuBatch"></div>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="btnUp" type="button" style="flex:1">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      </div>
      <div class="sep"></div>
      <button id="btnGoogleUp" type="button" style="width:100%">Ø¥Ù†Ø´Ø§Ø¡/Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google</button>
      <div class="msg" id="hintUp" style="margin-top:8px"></div>
    </div>

    <!-- Sign In -->
    <div id="p-in" class="panel">
      <div class="grid2">
        <div class="field">
          <label class="msg">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="siEmail" inputmode="email" placeholder="you@example.com">
          <div class="msg" id="mSiEmail"></div>
        </div>
        <div class="field">
          <label class="msg">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="siPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          <span class="eye" data-eye="siPass">ğŸ‘ï¸</span>
          <div class="msg" id="mSiPass"></div>
        </div>
        <div>
          <label class="msg">Ø§Ù„Ù„ØºØ©</label>
          <select id="siLang"><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option><option value="en">English</option></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px;justify-content:space-between">
        <button id="btnIn" class="ghost" type="button">Ø¯Ø®ÙˆÙ„</button>
        <button id="btnForgot" class="ghost" type="button">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</button>
      </div>
      <div class="msg" id="hintIn" style="margin-top:8px"></div>
    </div>
  </div>
</section>

<!-- Forgot -->
<section id="fgBox" class="gate" style="display:none;background:rgba(0,0,0,.7)">
  <div class="box">
    <h3 style="margin:.2rem 0 8px">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
    <p class="msg">Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ + Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ + Ø§Ù„Ø¯ÙØ¹Ø©. Ù„Ùˆ Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ† Ù‡Ù†Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºÙŠÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„.</p>
    <div class="grid2">
      <div><label class="msg">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label><input id="fgEmail" inputmode="email"></div>
      <div><label class="msg">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label><input id="fgPhone" inputmode="tel" placeholder="01xxxxxxxxx"></div>
      <div><label class="msg">Ø§Ù„Ø¯ÙØ¹Ø©</label><input id="fgBatch"></div>
    </div>
    <div class="row" style="margin-top:10px;justify-content:space-between">
      <button id="btnFgSend" type="button">ØªØ­Ù‚Ù‚ ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
      <button id="btnFgClose" class="ghost" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="msg" id="hintFg" style="margin-top:8px"></div>
  </div>
</section>

<!-- ===== App after login ===== -->
<main id="app" class="container" style="display:none">
  <section id="v-home" class="view">
    <div class="card">
      <h2 style="margin:0 0 6px">Ø¬Ø§Ù‡Ø²ÙŠÙ†</h2>
      <p>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­. Ø³Ù†Ø¶ÙŠÙ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª ÙˆØ§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„Ù€QR ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù.</p>
      <div class="sep"></div>
      <p class="msg">Ù„Ùˆ Ø§Ù„Ø´Ø§Ø±Ø© ÙÙˆÙ‚ ÙÙŠÙ‡Ø§ âœ“ Ù…Ø±ØªØ¨Ø· ÙÙƒÙ„ Ø´ÙŠØ¡ ØªÙ…Ø§Ù….</p>
    </div>
  </section>

  <section id="v-profile" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h2>
      <div class="grid2">
        <div><label class="msg">Ø§Ù„Ø§Ø³Ù…</label><input id="pName"></div>
        <div><label class="msg">Ø§Ù„Ø¨Ø±ÙŠØ¯</label><input id="pEmail" disabled></div>
        <div><label class="msg">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label><input id="pPhone"></div>
        <div><label class="msg">Ø§Ù„Ø¯ÙØ¹Ø©</label><input id="pBatch"></div>
      </div>
      <div class="row" style="margin-top:10px"><button id="btnSaveProfile" class="ghost" type="button">Ø­ÙØ¸ (Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù†)</button></div>
    </div>
  </section>

  <section id="v-settings" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
      <div class="grid2">
        <div><label class="msg">Ø§Ù„ÙˆØ¶Ø¹</label><button id="themeToggle" class="ghost" type="button">ØªØ¨Ø¯ÙŠÙ„ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ</button></div>
        <div><label class="msg">Ø­Ø¬Ù… Ø§Ù„Ù†Øµ</label>
          <select id="fs"><option value="16">Ø§ÙØªØ±Ø§Ø¶ÙŠ</option><option value="17">ÙƒØ¨ÙŠØ±</option><option value="18">Ø£ÙƒØ¨Ø±</option></select>
        </div>
        <div><label class="msg">Ø§Ù„Ù„ØºØ©</label><select id="lang"><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option><option value="en">English</option></select></div>
        <div><label class="msg">Ø¬Ù„Ø³Ø©</label><button id="btnOut" class="danger" type="button" style="width:100%">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></div>
      </div>
      <div class="sep"></div>
      <button id="clear" class="ghost" type="button">Ù…Ø³Ø­ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
    </div>
  </section>
</main>

<nav id="nav" class="bottom" style="display:none">
  <button class="active" data-view="v-home" type="button">ğŸ  Ø¹Ø§Ù…</button>
  <button data-view="v-profile" type="button">ğŸ‘¤ Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
  <button data-view="v-settings" type="button">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div id="toast" class="toast"></div>

<!-- ===== Firebase (compat) ===== -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
/* ---------- UI helpers ---------- */
(function(){
  // tabs
  const tabs=document.querySelectorAll('.tab'), panels={up:document.getElementById('p-up'),in:document.getElementById('p-in')};
  tabs.forEach(t=>t.onclick=()=>{tabs.forEach(x=>x.classList.remove('active'));t.classList.add('active');Object.values(panels).forEach(p=>p.classList.remove('show'));panels[t.dataset.tab].classList.add('show')});
  // eyes
  document.querySelectorAll('.eye').forEach(e=>e.onclick=()=>{const id=e.getAttribute('data-eye'); const i=document.getElementById(id); i.type=(i.type==='password'?'text':'password')});
  // theme + font
  const th=localStorage.getItem('theme'); if(th==='light') document.documentElement.classList.add('light');
  const tgl=document.getElementById('themeToggle'); if(tgl) tgl.onclick=()=>{const isLight=document.documentElement.classList.toggle('light'); localStorage.setItem('theme',isLight?'light':'dark')};
  const fs=document.getElementById('fs'), saved=localStorage.getItem('fs'); if(saved) document.body.style.fontSize=saved+'px';
  if(fs){ fs.value=saved||'16'; fs.onchange=()=>{document.body.style.fontSize=fs.value+'px'; localStorage.setItem('fs',fs.value)}}
  // nav
  const views=document.querySelectorAll('.view'); const navBtns=document.querySelectorAll('#nav button');
  function show(id){views.forEach(v=>v.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');navBtns.forEach(b=>b.classList.toggle('active',b.dataset.view===id))}
  navBtns.forEach(b=>b.onclick=()=>show(b.dataset.view)); show('v-home');
})();
</script>

<script>
/* ---------- Firebase logic ---------- */
const cfg={apiKey:"AIzaSyDfiO-4J0DIHSKZo_vdBXeS343eJ0x4pYo",authDomain:"ittihad-med-kfs.firebaseapp.com",projectId:"ittihad-med-kfs",appId:"1:323302922960:web:3343605d75d2a5147cdcd5"};
firebase.initializeApp(cfg);
const auth=firebase.auth(), db=firebase.firestore();

const $=id=>document.getElementById(id);
const toast=(t)=>{const x=$('toast');x.textContent=t;x.classList.add('show');setTimeout(()=>x.classList.remove('show'),2500)}
const L=s=>(s||'').trim(), emailOk=e=>/^\S+@\S+\.\S+$/.test(e||''), phoneOk=p=>/^01\d{9}$/.test((p||'').replace(/\s+/g,'')), nameOk=n=>L(n).length>=5 && /\s/.test(L(n));
const mark=(el,ok,msg)=>(el&&(el.classList.remove('invalid','valid'),el.classList.add(ok?'valid':'invalid'), msg&& (msg.textContent='')));

/* status */
db.collection('ping').doc('hello').set({t:Date.now()}).then(()=>$('status').textContent='âœ“ Ù…Ø±ØªØ¨Ø·').catch(()=>$('status').textContent='âœ“ Ù…Ø±ØªØ¨Ø·');

/* ---- Sign Up ---- */
$('btnUp').onclick=async ()=>{
  const email=L($('suEmail').value), pass=$('suPass').value, pass2=$('suPass2').value, name=L($('suName').value),
        phone=L($('suPhone').value), batch=L($('suBatch').value), lang=$('suLang').value;
  let ok=true;
  if(!emailOk(email)){ok=false;$('suEmail').classList.add('invalid');$('mSuEmail').textContent='Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­'} else {$('suEmail').classList.remove('invalid')}
  if(pass.length<6){ok=false;$('suPass').classList.add('invalid');$('mSuPass').textContent='Ù¦ Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'} else {$('suPass').classList.remove('invalid')}
  if(pass!==pass2){ok=false;$('suPass2').classList.add('invalid');$('mSuPass2').textContent='ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚'} else {$('suPass2').classList.remove('invalid')}
  if(!nameOk(name)){ok=false;$('suName').classList.add('invalid');$('mSuName').textContent='Ø§ÙƒØªØ¨ Ø§Ø³Ù… + Ø¹Ø§Ø¦Ù„Ø© (â‰¥5)'} else {$('suName').classList.remove('invalid')}
  if(!phoneOk(phone)){ok=false;$('suPhone').classList.add('invalid');$('mSuPhone').textContent='Ø§Ù„ØµÙŠØºØ© 01xxxxxxxxx'} else {$('suPhone').classList.remove('invalid')}
  if(!batch){ok=false;$('suBatch').classList.add('invalid');$('mSuBatch').textContent='Ø§ÙƒØªØ¨ Ø§Ù„Ø¯ÙØ¹Ø©'} else {$('suBatch').classList.remove('invalid')}
  if(!ok) return;

  try{
    const c=await auth.createUserWithEmailAndPassword(email,pass);
    await db.collection('users').doc(c.user.uid).set({displayName:name,email,phone,batch,lang,createdAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
    localStorage.setItem('lang',lang);
    $('hintUp').textContent='ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ”'; toast('ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ âœ” â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†');
  }catch(e){
    if((e.code||'').includes('email-already-in-use')){$('mSuEmail').textContent='Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…';$('suEmail').classList.add('invalid')}
    $('hintUp').textContent=e.message||String(e);
  }
};

/* Google */
$('btnGoogleUp').onclick=async()=>{ try{ await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }catch(e){ $('hintUp').textContent=e.message||String(e);} };

/* ---- Sign In ---- */
$('btnIn').onclick=async ()=>{
  const email=L($('siEmail').value), pass=$('siPass').value, lang=$('siLang').value;
  if(!emailOk(email)){ $('mSiEmail').textContent='Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­'; $('siEmail').classList.add('invalid'); return}
  try{ await auth.signInWithEmailAndPassword(email,pass); localStorage.setItem('lang',lang); $('hintIn').textContent='' }
  catch(e){
    const c=e.code||''; if(c.includes('wrong-password')||c.includes('invalid-credential')){$('mSiPass').textContent='ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';$('siPass').classList.add('invalid')}
    if(c.includes('user-not-found')){$('mSiEmail').textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯';$('siEmail').classList.add('invalid')}
    $('hintIn').textContent=e.message||String(e);
  }
};

/* Forgot */
$('btnForgot').onclick=()=>{$('fgBox').style.display='grid';$('hintFg').textContent=''};
$('btnFgClose').onclick=()=>{$('fgBox').style.display='none'};
$('btnFgSend').onclick=async ()=>{
  const email=L($('fgEmail').value), phone=L($('fgPhone').value), batch=L($('fgBatch').value);
  if(!emailOk(email)) return $('hintFg').textContent='Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­';
  try{
    const q=await db.collection('users').where('email','==',email).limit(1).get();
    if(q.empty) return $('hintFg').textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯';
    const u=q.docs[0].data();
    if((u.phone||'')!==phone || (u.batch||'')!==batch) return $('hintFg').textContent='Ø§Ù„ØªØ­Ù‚Ù‚ ÙØ´Ù„: Ø±Ù‚Ù… Ø£Ùˆ Ø¯ÙØ¹Ø© ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©';
    await auth.sendPasswordResetEmail(email);
    $('hintFg').textContent='ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† âœ”';
  }catch(e){ $('hintFg').textContent=e.message||String(e) }
};

/* Session */
const gate=$('gate'), app=$('app'), nav=$('nav');
const showApp=()=>{ gate.style.display='none'; app.style.display='block'; nav.style.display='flex' }
const hideApp=()=>{ app.style.display='none'; nav.style.display='none'; gate.style.display='grid' }

auth.onAuthStateChanged(async(u)=>{
  if(u){ // logged in
    showApp();
    $('status').textContent = (['dr.emara10@gmail.com'].includes((u.email||'').toLowerCase()) ? 'ğŸ‘‘ Admin â€” ' : 'Ø¹Ø¶Ùˆ â€” ') + (u.email||'');
    // hydrate profile
    $('pEmail').value=u.email||''; 
    try{ const d=await db.collection('users').doc(u.uid).get(); if(d.exists){ const v=d.data(); $('pName').value=v.displayName||''; $('pPhone').value=v.phone||''; $('pBatch').value=v.batch||''; } }catch(_){}
  }else{ hideApp(); $('status').textContent='âœ“ Ù…Ø±ØªØ¨Ø·' }
});

$('btnOut').onclick=()=>auth.signOut();

/* profile local save */
$('btnSaveProfile').onclick=()=>{ const data={n:$('pName').value,e:$('pEmail').value,ph:$('pPhone').value,b:$('pBatch').value}; localStorage.setItem('profileDraft',JSON.stringify(data)); toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§') }
const d=localStorage.getItem('profileDraft'); if(d){const v=JSON.parse(d);$('pName').value=v.n||'';$('pEmail').value=v.e||'';$('pPhone').value=v.ph||'';$('pBatch').value=v.b||''}
$('clear').onclick=()=>{localStorage.clear(); location.reload()}
</script>
</body>
  </html>
