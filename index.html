<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</title>
<meta name="theme-color" content="#0d1116"/>

<style>
:root{
  --bg1:#0b1016; --bg2:#0f1520;
  --card:rgba(255,255,255,.06);
  --surface:linear-gradient(160deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  --txt:#e8edf3; --mut:#9aa6b2; --bor:rgba(255,255,255,.12);
  --ring:rgba(56,189,248,.35);
  --acc1:#38bdf8; --acc2:#22c55e; --danger:#b91c1c;
  --shadow:0 10px 35px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.06);
  --r-xl:20px; --r-lg:16px; --r-md:12px;
  --pad:16px; --gap:14px; --blur:12px;
}
:root.light{
  --bg1:#f6f7fb; --bg2:#ffffff;
  --card:rgba(255,255,255,.9);
  --surface:linear-gradient(160deg,rgba(255,255,255,1),rgba(255,255,255,.9));
  --txt:#101827; --mut:#6b7280; --bor:rgba(17,24,39,.12);
  --ring:rgba(34,197,94,.25);
  --acc1:#0891b2; --acc2:#16a34a;
  --shadow:0 12px 30px rgba(17,24,39,.08), inset 0 1px 0 rgba(255,255,255,.8);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font:16px/1.8 ui-rounded,system-ui,Segoe UI,Arial;
  color:var(--txt);
  background:radial-gradient(1200px 800px at 10% 10%, #0ea5e980 0%, transparent 50%),
             radial-gradient(1200px 800px at 90% 30%, #22c55e60 0%, transparent 55%),
             linear-gradient(160deg,var(--bg1),var(--bg2)) fixed;
  -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
}
a{color:inherit}
.topbar{
  position:sticky;top:0;z-index:30;
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 18px;border-bottom:1px solid var(--bor);
  background:linear-gradient(160deg,rgba(0,0,0,.35),rgba(0,0,0,.12));
  backdrop-filter:blur(var(--blur));
}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.3px}
.brand .logo{
  width:34px;height:34px;border-radius:12px;
  background:conic-gradient(from 200deg,var(--acc1),var(--acc2));
  box-shadow:0 8px 20px rgba(34,197,94,.25); display:grid;place-items:center;color:#fff;
}
.badge{border:1px solid var(--bor);border-radius:999px;padding:7px 12px;background:rgba(255,255,255,.06);color:var(--mut);font-size:12px}

.container{max-width:1100px;margin:0 auto;padding:20px}
.view.hidden{display:none}
.card{
  background:var(--card); border:1px solid var(--bor); border-radius:var(--r-xl);
  padding:var(--pad); box-shadow:var(--shadow); backdrop-filter:blur(var(--blur));
  transition:transform .15s, border-color .15s
}
.card:hover{transform:translateY(-2px); border-color:color-mix(in srgb,var(--acc1) 35%,var(--bor))}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:var(--gap)}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

input,select,button{
  border:1px solid var(--bor); border-radius:var(--r-md);
  background:rgba(255,255,255,.05); color:var(--txt);
  padding:11px 12px; outline:none; transition:.18s
}
input:focus,select:focus{border-color:color-mix(in srgb,var(--acc1) 45%,var(--bor)); box-shadow:0 0 0 5px var(--ring)}
button{
  cursor:pointer; border-radius:14px; font-weight:800; letter-spacing:.2px;
  background:linear-gradient(135deg, color-mix(in srgb,var(--acc1) 60%, transparent), color-mix(in srgb,var(--acc2) 50%, transparent));
  color:#fff; border:1px solid var(--bor); box-shadow:0 8px 24px rgba(0,0,0,.22)
}
button.ghost{background:rgba(255,255,255,.06); color:var(--txt)}
button.danger{background:var(--danger)}
button:hover{filter:brightness(1.06)} button:active{transform:translateY(1px)}
.muted{color:var(--mut);font-size:13px}
.sep{height:1px;background:var(--bor);margin:10px 0;border-radius:999px}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.bottom{
  position:sticky;bottom:0;z-index:25;display:flex;gap:12px;justify-content:space-around;padding:14px;
  border-top:1px solid var(--bor); background:linear-gradient(0deg,rgba(0,0,0,.35),rgba(0,0,0,.12)); backdrop-filter:blur(var(--blur))
}
.bottom button{flex:1;text-align:center}
.bottom .active{box-shadow:0 0 0 3px var(--ring) inset}
.post{border:1px solid var(--bor);border-radius:14px;padding:12px;background:rgba(255,255,255,.05)}

/* ===== Gate (tabs) ===== */
.gate{position:fixed; inset:0; display:grid; place-items:center; z-index:40; padding:18px;
  background:linear-gradient(160deg,rgba(0,0,0,.65),rgba(0,0,0,.55)); backdrop-filter:blur(6px);}
.gate .box{width:min(560px,100%); border:1px solid var(--bor); border-radius:20px; padding:18px; background:var(--surface); box-shadow:var(--shadow)}
.tabs{display:flex;gap:8px; border-bottom:1px solid var(--bor); margin-bottom:10px}
.tab{padding:10px 12px; border:1px solid var(--bor); border-bottom:none; border-radius:12px 12px 0 0; background:rgba(255,255,255,.05); cursor:pointer; color:var(--mut)}
.tab.active{background:rgba(0,0,0,.12); color:var(--txt)}
.panel{display:none}.panel.show{display:block}

/* Toast */
.toast{position:fixed;left:14px;right:14px;bottom:90px;background:#b91c1c;color:#fff;padding:12px;border-radius:14px;z-index:60;display:none}
.toast.show{display:block}

/* avatar */
.avatar{width:96px;height:96px;border-radius:50%;border:2px solid var(--bor);object-fit:cover;background:#111}
</style>
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="logo">ğŸ›ï¸</div>
    <div>Ø§ØªØ­Ø§Ø¯ Ø·Ø¨ Ø¨Ø´Ø±ÙŠ ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</div>
  </div>
  <div class="badge" id="statusBadge">â€¦</div>
</header>

<!-- ===== Gate (Sign Up / Sign In) ===== -->
<section id="gate" class="gate">
  <div class="box">
    <div class="tabs">
      <button class="tab active" data-tab="up">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      <button class="tab" data-tab="in">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- Sign Up -->
    <div id="panel-up" class="panel show">
      <div class="grid">
        <div>
          <label class="muted">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="suEmail" placeholder="you@example.com" inputmode="email">
        </div>
        <div>
          <label class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="suPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <div>
          <label class="muted">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="suPass2" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø§Ø³Ù…</label>
          <input id="suName" placeholder="Ø§Ø³Ù…Ùƒ">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
          <input id="suPhone" placeholder="01xxxxxxxxx" inputmode="tel">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø¯ÙØ¹Ø©</label>
          <input id="suBatch" placeholder="Ù…Ø«Ø§Ù„: 12">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div style="flex:1">
          <label class="muted">Ø§Ù„Ù„ØºØ©</label>
          <select id="suLang">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en">English</option>
          </select>
        </div>
        <button id="btnSignUp" style="flex:1">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      </div>
      <div class="sep"></div>
      <button id="btnGoogleUp" style="width:100%">Ø¥Ù†Ø´Ø§Ø¡/Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google</button>
      <div class="muted" id="hintUp" style="margin-top:8px"></div>
    </div>

    <!-- Sign In -->
    <div id="panel-in" class="panel">
      <div class="grid">
        <div>
          <label class="muted">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="siEmail" placeholder="you@example.com" inputmode="email">
        </div>
        <div>
          <label class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="siPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div style="flex:1">
          <label class="muted">Ø§Ù„Ù„ØºØ©</label>
          <select id="siLang">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en">English</option>
          </select>
        </div>
        <button id="btnSignIn" style="flex:1" class="ghost">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:8px">
        <button id="btnForgot" class="ghost">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</button>
        <div class="muted" id="hintIn"></div>
      </div>
    </div>
  </div>
</section>

<!-- Forgot modal -->
<section id="forgotBox" class="gate" style="display:none;background:rgba(0,0,0,.7)">
  <div class="box">
    <h3 style="margin:.2rem 0 8px">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
    <p class="muted" style="margin-top:0">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ + Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ + Ø§Ù„Ø¯ÙØ¹Ø©. Ù„Ùˆ Ø·Ø§Ø¨Ù‚ÙˆØ§ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„.</p>
    <div class="grid">
      <div>
        <label class="muted">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
        <input id="fgEmail" placeholder="you@example.com" inputmode="email">
      </div>
      <div>
        <label class="muted">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
        <input id="fgPhone" placeholder="01xxxxxxxxx" inputmode="tel">
      </div>
      <div>
        <label class="muted">Ø§Ù„Ø¯ÙØ¹Ø©</label>
        <input id="fgBatch" placeholder="Ù…Ø«Ø§Ù„: 12">
      </div>
    </div>
    <div class="row" style="margin-top:10px;justify-content:space-between">
      <button id="btnFgSend">ØªØ­Ù‚Ù‚ ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
      <button id="btnFgClose" class="ghost">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="muted" id="hintFg" style="margin-top:8px"></div>
  </div>
</section>

<!-- ===== Main (after login) ===== -->
<main class="container" id="app" style="display:none">

  <!-- Ø¹Ø§Ù… -->
  <section id="view-home" class="view">
    <div class="card">
      <div class="row" style="align-items:center">
        <div class="glyph">ğŸ“£</div>
        <div>
          <h2 style="margin:0 0 6px">Ø¬Ø§Ù‡Ø²ÙŠÙ†</h2>
          <p style="margin:0">ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ù‡Ù†Ø¶ÙŠÙ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø§Ù„Ø¨ÙˆØ³ØªØ§ØªØŒ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„Ù€QRØŒ ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù.</p>
          <div class="sep"></div>
          <p class="muted" style="margin:0">Ù„Ùˆ Ø§Ù„Ø´Ø§Ø±Ø© ÙÙˆÙ‚ Ø¨Ù‚Øª âœ“ Ù…Ø±ØªØ¨Ø· â€” Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Firebase ØªÙ…Ø§Ù….</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
  <section id="view-profile" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h2>
      <div class="row" style="align-items:center">
        <img id="avatar" class="avatar" alt="avatar">
        <div>
          <input id="avatarFile" type="file" accept="image/*">
          <div class="muted">* Ø§Ù„ØµÙˆØ±Ø© ØªÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù† (Ù†Ø±Ø¨Ø·Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø§Ù„ØªØ®Ø²ÙŠÙ†).</div>
        </div>
      </div>
      <div class="grid" style="margin-top:10px">
        <div>
          <label class="muted">Ø§Ù„Ø§Ø³Ù…</label>
          <input id="pName" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
          <input id="pEmail" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
          <input id="pPhone" placeholder="â€”">
        </div>
        <div>
          <label class="muted">Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹Ø©</label>
          <input id="pBatch" placeholder="â€”">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="ghost" id="btnSaveProfile">Ø­ÙØ¸ (Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù†)</button>
      </div>
    </div>
  </section>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <section id="view-settings" class="view hidden">
    <div class="card">
      <h2 style="margin-top:0">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
      <div class="grid">
        <div>
          <label class="muted">Ø§Ù„ÙˆØ¶Ø¹</label>
          <div class="row">
            <button id="themeToggle" class="ghost">ØªØ¨Ø¯ÙŠÙ„ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ</button>
          </div>
        </div>
        <div>
          <label class="muted">Ø­Ø¬Ù… Ø§Ù„Ù†Øµ</label>
          <select id="fontSizeSel">
            <option value="16">Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
            <option value="17">ÙƒØ¨ÙŠØ±</option>
            <option value="18">Ø£ÙƒØ¨Ø±</option>
            <option value="19">Ø¶Ø®Ù…</option>
          </select>
        </div>
        <div>
          <label class="muted">Ø§Ù„Ù„ØºØ©</label>
          <select id="langSel">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en">English</option>
          </select>
        </div>
        <div>
          <label class="muted">Ø¬Ù„Ø³Ø©</label><br/>
          <button id="btnSignOut" class="danger" style="width:100%">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
      <div class="sep"></div>
      <button class="ghost" id="btnClearLocal">Ù…Ø³Ø­ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
    </div>
  </section>
</main>

<nav class="bottom" id="nav" style="display:none">
  <button class="active" data-view="view-home">ğŸ  Ø¹Ø§Ù…</button>
  <button data-view="view-profile">ğŸ‘¤ Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
  <button data-view="view-settings">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div class="toast" id="toast"></div>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
/* UI basics: theme/lang/font/nav + avatar local save */
(function(){
  // theme
  const th=localStorage.getItem('theme'); if(th==='light') document.documentElement.classList.add('light');
  const tgl=document.getElementById('themeToggle'); if(tgl){ tgl.onclick=()=>{const isLight=document.documentElement.classList.toggle('light'); localStorage.setItem('theme',isLight?'light':'dark');}; }

  // font size
  const fsSel=document.getElementById('fontSizeSel');
  const savedFs=localStorage.getItem('fs'); if(savedFs) document.body.style.fontSize=savedFs+'px';
  if(fsSel){ fsSel.value=savedFs||'16'; fsSel.onchange=()=>{document.body.style.fontSize=fsSel.value+'px'; localStorage.setItem('fs',fsSel.value);} }

  // language
  function applyLang(lang){ document.documentElement.lang=lang; document.dir=(lang==='ar'?'rtl':'ltr'); localStorage.setItem('lang',lang); const s=document.getElementById('langSel'); if(s) s.value=lang; }
  applyLang(localStorage.getItem('lang')||'ar');
  const langSel=document.getElementById('langSel'); if(langSel){ langSel.onchange=()=>applyLang(langSel.value); }

  // nav
  const views=document.querySelectorAll('.view');
  const navBtns=document.querySelectorAll('.bottom button');
  function show(id){ views.forEach(v=>v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); navBtns.forEach(b=>b.classList.toggle('active',b.dataset.view===id)); }
  navBtns.forEach(b=>b.onclick=()=>show(b.dataset.view)); show('view-home');

  // avatar local preview/save
  const av=document.getElementById('avatar'), file=document.getElementById('avatarFile');
  const savedAv=localStorage.getItem('avatarData'); if(savedAv) av.src=savedAv;
  if(file){ file.onchange=(e)=>{const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{av.src=r.result; localStorage.setItem('avatarData', r.result);}; r.readAsDataURL(f);} }

  // tabs gate
  const tabs=document.querySelectorAll('.tab'); const panels={up:document.getElementById('panel-up'), in:document.getElementById('panel-in')};
  tabs.forEach(t=>t.onclick=()=>{tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active'); Object.values(panels).forEach(p=>p.classList.remove('show')); panels[t.dataset.tab].classList.add('show');});
})();
</script>

<script>
/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDfiO-4J0DIHSKZo_vdBXeS343eJ0x4pYo",
  authDomain: "ittihad-med-kfs.firebaseapp.com",
  projectId: "ittihad-med-kfs",
  appId: "1:323302922960:web:3343605d75d2a5147cdcd5"
};
firebase.initializeApp(firebaseConfig);

(function(){
  const ADMINS=['dr.emara10@gmail.com']; // ğŸ‘‘

  const gate=document.getElementById('gate');
  const app =document.getElementById('app');
  const nav =document.getElementById('nav');
  const badge=document.getElementById('statusBadge');
  const toast=document.getElementById('toast'); const say=(m)=>{toast.textContent=m; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),4000);};

  const db=firebase.firestore(); const auth=firebase.auth();

  // status
  if(badge) badge.textContent='â€¦ Ø±Ø¨Ø· Firebase';
  db.collection('ping').doc('hello').get().then(()=>{ if(badge) badge.textContent='âœ“ Ù…Ø±ØªØ¨Ø·'; }).catch(()=>{ if(badge) badge.textContent='âœ“ Ù…Ø±ØªØ¨Ø·'; });

  // Sign Up elements
  const suEmail=document.getElementById('suEmail'), suPass=document.getElementById('suPass'), suPass2=document.getElementById('suPass2'),
        suName=document.getElementById('suName'), suPhone=document.getElementById('suPhone'), suBatch=document.getElementById('suBatch'),
        suLang=document.getElementById('suLang'), hintUp=document.getElementById('hintUp'), btnSignUp=document.getElementById('btnSignUp'),
        btnGoogleUp=document.getElementById('btnGoogleUp');

  // Sign In elements
  const siEmail=document.getElementById('siEmail'), siPass=document.getElementById('siPass'),
        siLang=document.getElementById('siLang'), btnSignIn=document.getElementById('btnSignIn'),
        hintIn=document.getElementById('hintIn'), btnForgot=document.getElementById('btnForgot');

  // Forgot modal
  const fg=document.getElementById('forgotBox'), fgEmail=document.getElementById('fgEmail'), fgPhone=document.getElementById('fgPhone'),
        fgBatch=document.getElementById('fgBatch'), btnFgSend=document.getElementById('btnFgSend'), btnFgClose=document.getElementById('btnFgClose'),
        hintFg=document.getElementById('hintFg');

  // Settings actions
  const btnOut=document.getElementById('btnSignOut');

  const L=s=>(s||'').trim(); const lower=s=>L(s).toLowerCase();
  const validEmail=(e)=>/^\S+@\S+\.\S+$/.test(e||'');
  const validPhone=(p)=>/^01\d{9}$/.test((p||'').replace(/\s+/g,''));

  // SIGN UP (email/password)
  if(btnSignUp) btnSignUp.onclick=async ()=>{
    try{
      const email=L(suEmail.value), pass=suPass.value, pass2=suPass2.value,
            name=L(suName.value), phone=L(suPhone.value), batch=L(suBatch.value), lang=suLang.value;
      if(!validEmail(email)) return hintUp.textContent='Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­';
      if(pass.length<6) return hintUp.textContent='ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
      if(pass!==pass2) return hintUp.textContent='ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚';
      if(name.length<2) return hintUp.textContent='Ø§ÙƒØªØ¨ Ø§Ø³Ù… ØµØ­ÙŠØ­';
      if(!validPhone(phone)) return hintUp.textContent='Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨ØµÙŠØºØ© 01xxxxxxxxx';
      const cred=await auth.createUserWithEmailAndPassword(email,pass);
      await db.collection('users').doc(cred.user.uid).set({
        displayName:name, email, phone, batch, lang,
        createdAt:firebase.firestore.FieldValue.serverTimestamp()
      },{merge:true});
      localStorage.setItem('lang',lang);
      hintUp.textContent='ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ”';
    }catch(e){ hintUp.textContent=e.message||String(e); }
  };
  if(btnGoogleUp) btnGoogleUp.onclick=async ()=>{ try{ await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }catch(e){ hintUp.textContent=e.message||String(e);} };

  // SIGN IN
  if(btnSignIn) btnSignIn.onclick=async ()=>{
    try{
      const email=L(siEmail.value), pass=siPass.value, lang=siLang.value;
      if(!validEmail(email)) return hintIn.textContent='Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­';
      await auth.signInWithEmailAndPassword(email,pass);
      localStorage.setItem('lang',lang);
    }catch(e){ hintIn.textContent=e.message||String(e); }
  };

  // FORGOT PASSWORD (verify phone & batch then send reset link)
  if(btnForgot) btnForgot.onclick=()=>{ fg.style.display='grid'; hintFg.textContent=''; };
  if(btnFgClose) btnFgClose.onclick=()=>{ fg.style.display='none'; };
  if(btnFgSend) btnFgSend.onclick=async ()=>{
    try{
      const email=L(fgEmail.value), phone=L(fgPhone.value), batch=L(fgBatch.value);
      if(!validEmail(email)) return hintFg.textContent='Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ ØµØ­ÙŠØ­';
      const q=await db.collection('users').where('email','==',email).limit(1).get();
      if(q.empty) return hintFg.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯';
      const user=q.docs[0].data();
      if((user.phone||'')!==L(phone) || (user.batch||'')!==L(batch)) return hintFg.textContent='Ø§Ù„ØªØ­Ù‚Ù‚ ÙØ´Ù„: Ø±Ù‚Ù… Ø£Ùˆ Ø¯ÙØ¹Ø© ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø©';
      await auth.sendPasswordResetEmail(email);
      hintFg.textContent='ØªÙ… Ø¥Ø±Ø³Ø§Ù„
